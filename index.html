<!-- index.html (Updated - Environment card removed, Rain Level trend card added for consistency) -->
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgriSense - Smart Agriculture Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Alert Toast Container -->
  <div class="alert-container" id="alertContainer"></div>
  
  <!-- Graph Modal -->
  <div class="modal-overlay" id="graphModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title-group">
          <span class="modal-icon" id="modalIcon">üìä</span>
          <div>
            <h2 class="modal-title" id="modalTitle">Sensor Data</h2>
            <p class="modal-subtitle" id="modalSubtitle">Last 24 hours</p>
          </div>
        </div>
        <button class="modal-close" onclick="closeGraphModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="time-range-bar">
          <button class="range-btn" data-hours="1" onclick="changeTimeRange(1)">1H</button>
          <button class="range-btn" data-hours="6" onclick="changeTimeRange(6)">6H</button>
          <button class="range-btn" data-hours="12" onclick="changeTimeRange(12)">12H</button>
          <button class="range-btn active" data-hours="24" onclick="changeTimeRange(24)">24H</button>
          <button class="range-btn" data-hours="168" onclick="changeTimeRange(168)">7D</button>
        </div>
        <div class="chart-wrapper">
          <canvas id="sensorChart"></canvas>
        </div>
        <div class="stats-row" id="chartStats">
          <div class="stat-box">
            <span class="stat-label">Current</span>
            <span class="stat-value" id="statCurrent">--</span>
          </div>
          <div class="stat-box">
            <span class="stat-label">Average</span>
            <span class="stat-value" id="statAvg">--</span>
          </div>
          <div class="stat-box">
            <span class="stat-label">Min</span>
            <span class="stat-value" id="statMin">--</span>
          </div>
          <div class="stat-box">
            <span class="stat-label">Max</span>
            <span class="stat-value" id="statMax">--</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard">
    <!-- Header (unchanged) -->
    <header class="header">
      <!-- ... (exact same header code as before) ... -->
      <div class="header-left">
        <div class="logo-mark">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
            <circle cx="16" cy="16" r="10" stroke="currentColor" stroke-width="1.5" opacity="0.5"/>
            <circle cx="16" cy="16" r="6" stroke="currentColor" stroke-width="1.5" opacity="0.7"/>
            <circle cx="16" cy="16" r="2" fill="currentColor"/>
          </svg>
        </div>
        <div class="header-title">
          <h1>AgriSense</h1>
          <span class="header-subtitle">Smart Agriculture Monitoring</span>
        </div>
      </div>
      <div class="header-right">
        <div class="theme-dropdown">
          <button class="theme-toggle" id="themeToggle" onclick="toggleThemeMenu()">
            <span class="theme-icon" id="themeIcon">üåô</span>
            <span class="theme-name" id="themeName">Dark</span>
            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M2.5 4.5L6 8L9.5 4.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
            </svg>
          </button>
          <div class="theme-menu" id="themeMenu">
            <button class="theme-option active" data-theme="dark" onclick="setTheme('dark')">
              <span>üåô</span> Dark
            </button>
            <button class="theme-option" data-theme="light" onclick="setTheme('light')">
              <span>‚òÄÔ∏è</span> Light
            </button>
            <button class="theme-option" data-theme="midnight" onclick="setTheme('midnight')">
              <span>üåå</span> Midnight
            </button>
            <button class="theme-option" data-theme="forest" onclick="setTheme('forest')">
              <span>üå≤</span> Forest
            </button>
            <button class="theme-option" data-theme="ocean" onclick="setTheme('ocean')">
              <span>üåä</span> Ocean
            </button>
          </div>
        </div>
        <button class="sound-btn" id="soundBtn" onclick="toggleSound()">
          <span id="soundIcon">üîá</span>
        </button>
        <div class="connection-status" id="connectionStatus">
          <span class="status-indicator"></span>
          <span class="status-label">Connecting...</span>
        </div>
        <div class="clock" id="clock">--:-- --</div>
      </div>
    </header>

    <!-- Main Grid -->
    <main class="main-grid">
      <!-- UV Index Card (unchanged) -->
      <div class="card card-lg clickable" id="uvCard" onclick="showGraph('UV', 'UV Index', '', '‚òÄÔ∏è')">
        <div class="card-header">
          <span class="card-title">UV Index</span>
          <span class="card-badge" id="uvBadge">Moderate</span>
        </div>
        <div class="gauge-container">
          <div class="circular-gauge" id="uvGauge">
            <svg viewBox="0 0 200 200">
              <circle class="gauge-bg" cx="100" cy="100" r="85"/>
              <circle class="gauge-progress" cx="100" cy="100" r="85" id="uvProgress"/>
              <circle class="gauge-inner" cx="100" cy="100" r="70"/>
            </svg>
            <div class="gauge-value">
              <span class="gauge-number" id="uvValue">--</span>
              <span class="gauge-label" id="uvLabel">UNKNOWN</span>
            </div>
          </div>
        </div>
        <div class="sparkline-container">
          <canvas id="uvSparkline"></canvas>
        </div>
      </div>

      <!-- Heat Index (unchanged) -->
      <div class="card card-lg">
        <div class="card-header">
          <span class="card-title">Heat Index</span>
          <span class="card-subtitle">Feels Like</span>
        </div>
        <div class="semicircle-gauge-container">
          <div class="semicircle-gauge">
            <svg viewBox="0 0 200 120">
              <defs>
                <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#22c55e"/>
                  <stop offset="40%" style="stop-color:#eab308"/>
                  <stop offset="70%" style="stop-color:#f97316"/>
                  <stop offset="100%" style="stop-color:#ef4444"/>
                </linearGradient>
              </defs>
              <path class="gauge-arc-bg" d="M 20 100 A 80 80 0 0 1 180 100"/>
              <path class="gauge-arc" d="M 20 100 A 80 80 0 0 1 180 100" id="hiArc"/>
              <circle class="gauge-needle-dot" cx="100" cy="100" r="8"/>
              <line class="gauge-needle" x1="100" y1="100" x2="100" y2="30" id="hiNeedle"/>
            </svg>
            <div class="semicircle-labels">
              <span>Good</span>
              <span>Fair</span>
              <span>Bad</span>
            </div>
            <div class="semicircle-value">
              <span id="hiValue">--</span>
              <span class="semicircle-unit">¬∞C</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Trend Cards (Temperature, Humidity, Soil Moisture, Rain Level) -->
      <div class="card card-trend clickable" onclick="showGraph('TP', 'Temperature', '¬∞C', 'üå°Ô∏è')">
        <div class="card-header">
          <span class="card-title">Temperature</span>
          <span class="card-subtitle">Trend</span>
        </div>
        <div class="trend-value">
          <span id="tempTrendValue">--</span>
          <span class="trend-unit">¬∞C</span>
        </div>
        <div class="sparkline-container">
          <canvas id="tempSparkline"></canvas>
        </div>
      </div>

      <div class="card card-trend clickable" onclick="showGraph('HM', 'Humidity', '%', 'üíß')">
        <div class="card-header">
          <span class="card-title">Humidity</span>
          <span class="card-subtitle">Trend</span>
        </div>
        <div class="trend-value">
          <span id="humTrendValue">--</span>
          <span class="trend-unit">%</span>
        </div>
        <div class="sparkline-container">
          <canvas id="humSparkline"></canvas>
        </div>
      </div>

      <div class="card card-trend clickable" onclick="showGraph('MO', 'Soil Moisture', '%', 'üåø')">
        <div class="card-header">
          <span class="card-title">Soil Moisture</span>
          <span class="card-subtitle">Trend</span>
        </div>
        <div class="trend-value">
          <span id="moistTrendValue">--</span>
          <span class="trend-unit">%</span>
        </div>
        <div class="sparkline-container">
          <canvas id="moistSparkline"></canvas>
        </div>
      </div>

      <!-- New: Rain Level Trend Card (added so Rain data is not lost) -->
      <div class="card card-trend clickable" onclick="showGraph('RN', 'Rain Level', '%', 'üåßÔ∏è')">
        <div class="card-header">
          <span class="card-title">Rain Level</span>
          <span class="card-subtitle">Trend</span>
        </div>
        <div class="trend-value">
          <span id="rainTrendValue">--</span>
          <span class="trend-unit">%</span>
        </div>
        <div class="sparkline-container">
          <canvas id="rainSparkline"></canvas>
        </div>
      </div>

      <!-- Pump, Alerts, History (unchanged) -->
      <div class="card card-pump" id="pumpCard">
        <div class="card-header">
          <span class="card-title">Irrigation System</span>
        </div>
        <div class="pump-display">
          <div class="pump-visual" id="pumpVisual">
            <div class="pump-ring"></div>
            <div class="pump-icon">üíß</div>
          </div>
          <div class="pump-info">
            <span class="pump-status" id="pumpStatus">OFF</span>
            <span class="pump-label" id="pumpLabel">System Idle</span>
          </div>
        </div>
      </div>

      <div class="card card-alerts">
        <div class="card-header">
          <span class="card-title">Recent Alerts</span>
          <span class="alert-count" id="alertCount">0</span>
        </div>
        <div class="alerts-list" id="alertsList">
          <div class="empty-state">
            <span class="empty-icon">üîî</span>
            <span>No alerts</span>
          </div>
        </div>
      </div>

      <div class="card card-history">
        <div class="card-header">
          <span class="card-title">Reading History</span>
          <span class="reading-count" id="readingCount">0</span>
        </div>
        <div class="history-table-wrapper">
          <table class="history-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Temp</th>
                <th>Hum</th>
                <th>UV</th>
                <th>Rain</th>
                <th>Soil</th>
                <th>Pump</th>
              </tr>
            </thead>
            <tbody id="historyBody">
              <tr>
                <td colspan="7" class="empty-cell">Waiting for data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Footer (unchanged) -->
    <footer class="footer">
      <div class="footer-left">
        <span class="footer-brand">AgriSense v2.0</span>
      </div>
      <div class="footer-right">
        <span class="date-display" id="dateDisplay">--/--/----</span>
      </div>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>